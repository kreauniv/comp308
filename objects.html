<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Objects &#8212; Comp308: Principles of Programming Languages v1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=3d3fbe02" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=5cb08e4e"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Objects - the Self way" href="objects-self.html" />
    <link rel="prev" title="On the choice between “error” and “do something reasonable” in design" href="errornot.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="objects">
<h1>Objects<a class="headerlink" href="#objects" title="Link to this heading">¶</a></h1>
<p>You can’t browse around many popular programming languages without running into
some claiming to be “object oriented”. This sketch is to examine what objects
are and how to provide linguistic facilities for working with them. The
approach here will be demonstrate these ideas in Racket code, with the
understanding that it can be translated into PicLang given support for
<code class="code highlight racket docutils literal highlight-racket"><span class="n">FunC</span></code> and <code class="code highlight racket docutils literal highlight-racket"><span class="n">ApplyC</span></code>.</p>
<section id="anton-s-koan">
<h2>Anton’s Koan<a class="headerlink" href="#anton-s-koan" title="Link to this heading">¶</a></h2>
<p>(By Anton van Straaten in a <a class="reference external" href="https://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg03277.html">2003 discussion thread with Guy Steele</a>.)</p>
<blockquote>
<div><p>The venerable master Qc Na was walking with his student, Anton. Hoping to
prompt the master into a discussion, Anton said “Master, I have heard that
objects are a very good thing - is this true?” Qc Na looked pityingly at
his student and replied, “Foolish pupil - objects are merely a poor man’s
closures.”</p>
<p>Chastised, Anton took his leave from his master and returned to his cell,
intent on studying closures. He carefully read the entire “Lambda: The
Ultimate…” series of papers and its cousins, and implemented a small Scheme
interpreter with a closure-based object system. He learned much, and looked
forward to informing his master of his progress.</p>
<p>On his next walk with Qc Na, Anton attempted to impress his master by
saying “Master, I have diligently studied the matter, and now understand
that objects are truly a poor man’s closures.” Qc Na responded by hitting
Anton with his stick, saying “When will you learn? Closures are a poor
man’s object.” At that moment, Anton became enlightened.</p>
</div></blockquote>
<p>The original post by van Straaten is also worth reading in its entirety.
<a class="footnote-reference brackets" href="#lament" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> You have some idea of closures at this point. If you already have some
ideas about what objects are, I’d urge you to go off and read the original post
and possibly even descend into the rabbit hole of writings linked to from
there.</p>
<div class="admonition-notes admonition">
<p class="admonition-title"><strong>Notes</strong></p>
<p>Other links from the above archived message -</p>
<dl>
<dt>“Oleg Kiselyov has a short article on the subject:</dt><dd><p><a class="reference external" href="http://okmij.org/ftp/Scheme/oop-in-fp.txt">http://okmij.org/ftp/Scheme/oop-in-fp.txt</a>” (<a class="reference external" href="ipfs://bafybeibuwysdkmmgjfsb3uz5ijvccanx3cjz46istvitjugknt5edlwdie/">ipfs link</a>,
<a class="reference external" href="ipfs://bafybeigfxmcyrr5we76op5mmf4b45iwakaslkl5uhvbjnxc2adpcdhqyaq/">pure-oo-system.scm</a>)</p>
</dd>
<dt>“… as I mentioned in the last paragraph of this message:</dt><dd><p><a class="reference external" href="https://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg01488.html">https://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg01488.html</a>”</p>
</dd>
<dt>“A closure is an object that supports exactly one method: ‘apply’.”</dt><dd><p>– Guy Steele Jr., co-creator of Scheme</p>
<p>(I’m a tad unsure whether Guy is quoting/paraphrasing Christian Quiennec
or it is his own statement.)</p>
</dd>
</dl>
<p>From - <a class="reference external" href="https://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg03269.html">https://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg03269.html</a></p>
</div>
<p>The above discussion pertains to which is “more fundamental”, and as with such
questions both answers (closures vs. objects) are correct, and both answers are
wrong. That was the point of the “Koan”.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="lament" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>I’m so glad this discussion happened on the open internet back then.
If this were today and these computer scientists had this discussion on a closed
medium like Facebook, we’ll be the poorer for it. – Srikumar</p>
</aside>
</aside>
<p>In this chapter, we’ll examine objects from both approaches, and add a third
perspective too – concurrency – in order to get a more complete grasp of the
variations you’re likely to encounter in the wild. The interesting bit is that
much of this should already look quite familiar to you. <a class="footnote-reference brackets" href="#ctheno" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="ctheno" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>This is also the reason why we did <a class="reference internal" href="control.html"><span class="doc">Control</span></a> before objects.</p>
</aside>
</aside>
</section>
<section id="the-many-faces-of-objects">
<h2>The many faces of “objects”<a class="headerlink" href="#the-many-faces-of-objects" title="Link to this heading">¶</a></h2>
<p>The literature of computer science and software engineering is littered with
several notions of objects and methodologies for software design based on them.
While some characteristics seem to recur, it may even appear that there is no
true consensus among conputer scientists about what exactly is to be considered
<em>essential</em> to the notion of an “object”.</p>
<p>But despair not, for we’ll examine several notions in these lectures, all of
which feature in one or more programming languages in wide use today. Our goal
here is to understand, from a mechanistic perspective, how one might go about
constructing any particular view of objects in a language. The goal underlying
that is to enable you to ask the right questions when faced with a new “object
oriented” language so you can quicky narrow down to its model of objects.</p>
</section>
<section id="objects-using-closures">
<h2>Objects using closures<a class="headerlink" href="#objects-using-closures" title="Link to this heading">¶</a></h2>
<p>Let’s take a simple object - a two-dimensional point with some properties and
behaviours and see how we can express it using only closures … which is about
all we’ve used so far. Before that though, we need to agree on how we’re
going to use objects in Racket code. We’ll use an expression of the following
form –</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">&lt;object&gt;</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">message-name</span><span class="w"> </span><span class="n">&lt;arg1&gt;</span><span class="w"> </span><span class="n">&lt;arg2&gt;</span><span class="w"> </span><span class="k">...</span><span class="p">)</span>
</pre></div>
</div>
<p>… to represent the computation that we verbally describe as “send the message
named <code class="docutils literal notranslate"><span class="pre">message-name</span></code> with the given arguments to the object <code class="docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code>”. A
common notion of objects maps the idea of “sending a message to an object” to
“invoking a method function on the object”. We’ll be looking at this approach
first.</p>
<p>So let’s write a function to make a “2D point object”.</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-point</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="w">    </span><span class="c1">; &quot;x&quot; is a &quot;property&quot; of a point.</span>
<span class="w">    </span><span class="c1">; It is modeled by two &quot;methods&quot;</span>
<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">get-x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">set-x</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">val</span><span class="p">))</span>

<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">get-y</span><span class="p">)</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">set-y</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">val</span><span class="p">))</span>

<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">dist2origin</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">y</span><span class="p">))))</span>

<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">dispatcher</span><span class="w"> </span><span class="n">message-name</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="n">message-name</span>
<span class="w">            </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">get-x</span><span class="w"> </span><span class="p">(</span><span class="n">get-x</span><span class="p">)]</span>
<span class="w">            </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">set-x</span><span class="w"> </span><span class="p">(</span><span class="n">set-x</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">args</span><span class="p">))]</span>
<span class="w">            </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">get-y</span><span class="w"> </span><span class="p">(</span><span class="n">get-y</span><span class="p">)]</span>
<span class="w">            </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">set-y</span><span class="w"> </span><span class="p">(</span><span class="n">set-y</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">args</span><span class="p">))]</span>
<span class="w">            </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">dist2origin</span><span class="w"> </span><span class="p">(</span><span class="n">dist2origin</span><span class="p">)]</span>
<span class="w">            </span><span class="p">[</span><span class="k">_</span><span class="w"> </span><span class="p">(</span><span class="nb">raise-argument-error</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">point</span>
<span class="w">                                     </span><span class="s2">&quot;Valid message name&quot;</span>
<span class="w">                                     </span><span class="n">message</span><span class="p">)]))</span>

<span class="w">    </span><span class="n">dispatcher</span><span class="p">)</span>
</pre></div>
</div>
<p>Observe the following in the above piece of code –</p>
<ol class="arabic simple">
<li><p>We model the two “properties” of our “point” object – <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> –
using a pair of methods each with the prefix <code class="docutils literal notranslate"><span class="pre">get-</span></code> and <code class="docutils literal notranslate"><span class="pre">set-</span></code>. This is
a common convention, but nothing sacrosanct about it.</p></li>
<li><p>The “identity” of our object is just the function that chooses which method
function to call based on the passed message name. We’ve called this
function the “dispatcher” because it functions like a post office,
dispatching the given name and arguments to the right method function.</p></li>
<li><p>We’ve treated the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> as mutable state. So our point carries
state that is mutable.</p></li>
</ol>
</section>
<section id="the-essence-of-objects-through-abstraction">
<h2>The essence of objects through β-abstraction<a class="headerlink" href="#the-essence-of-objects-through-abstraction" title="Link to this heading">¶</a></h2>
<p>We’re doing a bunch of things in the definition of our point object in the
preceding code sample. Which parts of that are essential to our definition?
That is, which of the parts are specific to the concept of a point and which
parts would be common code no matter what such object we try to define?</p>
<p>Let’s examine that using β-abstraction.</p>
<section id="lookup-table">
<h3>Lookup table<a class="headerlink" href="#lookup-table" title="Link to this heading">¶</a></h3>
<p>The dispatcher code can be factored into two parts – a) a function that looks
up the method function given the message name, and b) a function that makes
a dispatcher function given such a lookup function.</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">lookup-method</span><span class="w"> </span><span class="n">message-name</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="n">message-name</span>
<span class="w">        </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">get-x</span><span class="w"> </span><span class="n">get-x</span><span class="p">]</span>
<span class="w">        </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">set-x</span><span class="w"> </span><span class="n">set-x</span><span class="p">]</span>
<span class="w">        </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">get-y</span><span class="w"> </span><span class="n">get-y</span><span class="p">]</span>
<span class="w">        </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">set-y</span><span class="w"> </span><span class="n">set-y</span><span class="p">]</span>
<span class="w">        </span><span class="p">[</span><span class="o">&#39;</span><span class="ss">dist2origin</span><span class="w"> </span><span class="n">dist2origin</span><span class="p">]</span>
<span class="w">        </span><span class="p">[</span><span class="k">_</span><span class="w"> </span><span class="no">#f</span><span class="p">]))</span>

<span class="c1">; Observe that make-dispatcher is independent of the idea</span>
<span class="c1">; of a &quot;point&quot;. So we can now pull it outside the make-point</span>
<span class="c1">; function.</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-dispatcher</span><span class="w"> </span><span class="n">lookup-method</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">message-name</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">(</span><span class="n">lookup-method</span><span class="w"> </span><span class="n">message-name</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">method</span>
<span class="w">            </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">            </span><span class="p">(</span><span class="nb">raise-argument-error</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">lookup-method</span>
<span class="w">                                  </span><span class="s2">&quot;Valid message name&quot;</span>
<span class="w">                                  </span><span class="n">message-name</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">dispatcher</span><span class="w"> </span><span class="p">(</span><span class="n">make-dispatcher</span><span class="w"> </span><span class="n">lookup-method</span><span class="p">))</span>
</pre></div>
</div>
<p>The <cite>lookup-method</cite> is just a mapping function. This is something we can capture in
a simple table data structure as follows –</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">point-lookup-table</span>
<span class="w">    </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-x</span><span class="w"> </span><span class="n">get-x</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-x</span><span class="w"> </span><span class="n">set-x</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-y</span><span class="w"> </span><span class="n">get-y</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-y</span><span class="w"> </span><span class="n">set-y</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">dist2origin</span><span class="w"> </span><span class="n">dist2origin</span><span class="p">)))</span>

<span class="c1">; Note that this function is also now independent of the</span>
<span class="c1">; idea of a &quot;point&quot; and can therefore be moved out of the</span>
<span class="c1">; make-point function.</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-lookup</span><span class="w"> </span><span class="n">table</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">message-name</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="nb">assoc</span><span class="w"> </span><span class="n">message-name</span><span class="w"> </span><span class="n">table</span><span class="p">)</span>
<span class="w">            </span><span class="p">[(</span><span class="nb">list</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">method</span><span class="p">)</span><span class="w"> </span><span class="n">method</span><span class="p">]</span>
<span class="w">            </span><span class="p">[</span><span class="no">#f</span><span class="w"> </span><span class="no">#f</span><span class="p">])))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">lookup-method</span><span class="w"> </span><span class="p">(</span><span class="n">make-lookup</span><span class="w"> </span><span class="n">point-lookup-table</span><span class="p">))</span>
</pre></div>
</div>
<p>We can now combine the method function definitions and the lookup table
itself like this for convenience of reasoning –</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">point-lookup-table</span>
<span class="w">    </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-x</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-x</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">val</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-y</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-y</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">val</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">dist2origin</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">y</span><span class="p">)))))))</span>
</pre></div>
</div>
<p>We now no longer need the separate <code class="code highlight racket docutils literal highlight-racket"><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">get-x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">)</span></code> and so on,
and our <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-point</span></code> function just reduces to –</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-point</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">point-lookup-table</span>
<span class="w">        </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-x</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-x</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">val</span><span class="p">)))</span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-y</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-y</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">val</span><span class="p">)))</span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">dist2origin</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">y</span><span class="p">)))))))</span>

<span class="w">    </span><span class="p">(</span><span class="n">make-dispatcher</span><span class="w"> </span><span class="p">(</span><span class="n">make-lookup</span><span class="w"> </span><span class="n">point-lookup-table</span><span class="p">)))</span>
</pre></div>
</div>
<p>With the <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-dispatcher</span></code> and <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-lookup</span></code> functions having
been pulled out considering their independence of the “point” concept.</p>
<p>With this last form, we see that the essence of an object is “message
dispatch”.</p>
</section>
</section>
<section id="adding-new-behaviour">
<h2>Adding new behaviour<a class="headerlink" href="#adding-new-behaviour" title="Link to this heading">¶</a></h2>
<p>What if we want to make an “enhanced point” object which is capable of
calculating the distance to another point, as a new behaviour. We want
to accomplish this by reusing everything that our current point can do
without rewriting any of that code. Here is one way –</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-dispatcher</span><span class="w"> </span><span class="n">lookup-method</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">message-name</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">(</span><span class="n">lookup-method</span><span class="w"> </span><span class="n">message-name</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">method</span>
<span class="w">            </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">            </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">message-name</span><span class="w"> </span><span class="n">args</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-enhanced-point</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">(</span><span class="n">make-point</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">ep-lookup-table</span>
<span class="w">        </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">dist2pt</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">([</span><span class="n">dx</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-x</span><span class="p">))]</span>
<span class="w">                                           </span><span class="p">[</span><span class="n">dy</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-y</span><span class="p">))])</span>
<span class="w">                                        </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="n">dx</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="n">dy</span><span class="p">))))))))</span>

<span class="w">    </span><span class="p">(</span><span class="n">make-dispatcher</span><span class="w"> </span><span class="p">(</span><span class="n">make-lookup</span><span class="w"> </span><span class="n">ep-lookup-table</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
<p>We’ve now changed the dispatcher in an interesting way – pay attention to the
<code class="code highlight racket docutils literal highlight-racket"><span class="no">#f</span></code> case. Our underlying representation is the same as that of the original
<code class="code highlight racket docutils literal highlight-racket"><span class="n">make-point</span></code>, but we’re now adding a new piece of functionality to it
to get an “enhanced point”.</p>
<div class="admonition-terminology admonition">
<p class="admonition-title"><strong>Terminology</strong></p>
<p>An enhancement such as done above which adds functionality to an object
without adding new state is usually called a <strong>mixin</strong>. The intention is that
you can “mix in” many such granular pieces of functionality when defining
new objects and they’ll automatically work with your objects because they add
no state. For example, in our case, the <code class="code highlight racket docutils literal highlight-racket"><span class="n">dist2pt</span></code> method just relies on
sending the <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">get-x</span></code> message to our object and the object passed in.</p>
<p>Also note that in our implementation so far, as long as the <code class="code highlight racket docutils literal highlight-racket"><span class="n">p2</span></code>
argument responds to the <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">get-x</span></code> message in the appropriate manner –
i.e. by returning a numeric value, our method will happily calculate a
distance, even if the meaning of the returned number is different. The
<code class="code highlight racket docutils literal highlight-racket"><span class="n">p2</span></code> object just has to quack like a point for us to use it. This
principle is often referred to as <strong>duck typing</strong> – taking off from “If it
looks like a duck and quacks like a duck, it is a duck.”</p>
</div>
<p>Observe that while <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-point</span></code> used the internal <code class="code highlight racket docutils literal highlight-racket"><span class="n">x</span></code> and <code class="code highlight racket docutils literal highlight-racket"><span class="n">y</span></code>
variables as its state, our <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-enhanced-point</span></code> does not. What if it
wanted to add some new mutable properties – i.e. some new state?</p>
</section>
<section id="adding-new-state">
<h2>Adding new state<a class="headerlink" href="#adding-new-state" title="Link to this heading">¶</a></h2>
<p>The previous enhancement added a new method that reused the internal state of
the point object constructed by <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-point</span></code>. What if instead of that we
wanted to make a point that had a name attached to it – a “named point”?
We need new state to capture that.</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-named-point</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">(</span><span class="n">make-point</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">))</span>

<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">np-lookup-table</span>
<span class="w">        </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-name</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="n">name</span><span class="p">))</span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-name</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">val</span><span class="p">)))))</span>

<span class="w">    </span><span class="p">(</span><span class="n">make-dispatcher</span><span class="w"> </span><span class="p">(</span><span class="n">make-lookup</span><span class="w"> </span><span class="n">np-lookup-table</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="lessons-so-far">
<h2>Lessons so far<a class="headerlink" href="#lessons-so-far" title="Link to this heading">¶</a></h2>
<p>What we’ve seen so far is the following –</p>
<ol class="arabic simple">
<li><p>Objects have state which methods may read or write to.</p></li>
<li><p>The act of “sending a message to an object” can be modelled as the act
of “calling a corresponding method function”. This can be arranged via
a simplpe lookup table.</p></li>
<li><p>When a give message name is not found in an object’s lookup table,
we can arrange for the message to be redirected to another object
– a “parent” which is then responsible for handling it. If the
message cannot be handled by the parent, or transitively its parent,
an error will eventually be raised. This “passing on to a parent” serves
to reuse functionality defined in another object in case our object
is unable to handle something.</p></li>
<li><p>Handling state is tricky. Thus far, we have only managed to handle
state correctly because our <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-named-point</span></code> function creates
a new point using <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-point</span></code> within it. If the point object
were, for example, passed as an argument, we’ll face problems.</p></li>
</ol>
<div class="admonition-exercise admonition">
<p class="admonition-title"><strong>Exercise</strong></p>
<p>What are the consequences if <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-named-point</span></code>, instead of calling
<code class="code highlight racket docutils literal highlight-racket"><span class="n">make-point</span></code> within it, took an extra argument for the “parent” like
this? –</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-named-point</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">nl-lookup-table</span>
<span class="w">        </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">get-name</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="n">name</span><span class="p">))</span>
<span class="w">              </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">set-name</span><span class="w"> </span><span class="p">(</span><span class="k">λ</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">val</span><span class="p">)))))</span>

<span class="w">    </span><span class="p">(</span><span class="n">make-dispatcher</span><span class="w"> </span><span class="p">(</span><span class="n">make-lookup</span><span class="w"> </span><span class="n">np-lookup-table</span><span class="p">)</span><span class="w"> </span><span class="n">parent</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="objects-as-the-foundation">
<h2>Objects as the foundation<a class="headerlink" href="#objects-as-the-foundation" title="Link to this heading">¶</a></h2>
<p>Much like we initially played a game of “what if lambda functions were the only
things we had?” and showed how we can represent numbers, data structures etc.
with it, we can also start with the idea of objects and message sends as
fundamental and see if we can build a system around it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not a theoretical “thought experiment”. To varying degrees,
actual languages such as Java, Javascript, Ruby, Python, Smalltalk and Self
function on these principles. So do pay attention.</p>
</div>
<p>So we have objects that can be bound to symbols and we can send messages
to these objects like <code class="code highlight racket docutils literal highlight-racket"><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">message</span><span class="w"> </span><span class="n">arg1</span><span class="w"> </span><span class="n">arg2</span><span class="w"> </span><span class="k">...</span><span class="p">)</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Think about what values these <code class="code highlight racket docutils literal highlight-racket"><span class="n">arg1</span></code> and <code class="code highlight racket docutils literal highlight-racket"><span class="n">arg2</span></code> can be and,
for that matter, what <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">message</span></code> can be? You know the answer because we
just saw it in the earlier paragraph!</p>
</div>
<p>So, how do we create this kind of an object in the first place? Can you come
up with an answer for that? Remember that objects and message sending are the only
two things available to us!</p>
<p><strong>Think a little about this before reading on</strong>.</p>
<p>You probably guessed it right – by sending a message to another object. For
simplicity, we’l grant ourselves the <code class="code highlight racket docutils literal highlight-racket"><span class="k">define</span></code> expression similar to how
we did that when we explored the use of <code class="code highlight racket docutils literal highlight-racket"><span class="k">lambda</span></code>.</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="p">(</span><span class="n">obj-maker</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">make</span><span class="w"> </span><span class="n">init-arg1</span><span class="w"> </span><span class="n">init-arg2</span><span class="w"> </span><span class="k">...</span><span class="p">))</span>
<span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">message</span><span class="w"> </span><span class="n">arg1</span><span class="w"> </span><span class="n">arg2</span><span class="w"> </span><span class="k">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This <code class="code highlight racket docutils literal highlight-racket"><span class="n">obj-maker</span></code> object somehow packages the recipe to make the kind of
object we want. To be consistent, we’d expect it to make the same <strong>kind</strong> of
object every time we send it the <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">make</span></code> message. This is not a strict
requirement, but more to keep our sanity. For if it made random objects every
time we sent the <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">make</span></code> message, we will find it frustrating to work with
those objects.</p>
<p>So, in a sense, the <code class="code highlight racket docutils literal highlight-racket"><span class="n">obj-maker</span></code> itself stands for the “type” of the object
that gets made. We call this a <strong>class</strong>. To solidify this relationship
between an object and its maker, we can agree to a protocol that all objects
respond to an <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">isa</span></code> message by returning the object that made them.</p>
<div class="highlight-racket notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="p">(</span><span class="n">objclass</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">make</span><span class="w"> </span><span class="n">init-arg1</span><span class="w"> </span><span class="n">init-arg2</span><span class="w"> </span><span class="k">...</span><span class="p">))</span>
<span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="p">(</span><span class="nb">equal?</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">isa</span><span class="p">)</span><span class="w"> </span><span class="n">objclass</span><span class="p">))</span><span class="w"> </span><span class="c1">; Prints #t</span>
</pre></div>
</div>
<div class="admonition-terminology admonition">
<p class="admonition-title"><strong>Terminology</strong></p>
<p>We call an object like <code class="code highlight racket docutils literal highlight-racket"><span class="n">obj-maker</span></code>, whose sole purpose is to
manufacture objects and serve to identify what kind they are, as a
<strong>class</strong>. We call the objects a class manufactures as <strong>instances of the
class</strong>. A class is therefore also responsible for giving specific
<strong>behaviours</strong> to the objects it manufactures.</p>
</div>
<p>A question - what should we get when we send the <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">isa</span></code> message to the
<code class="code highlight racket docutils literal highlight-racket"><span class="n">objclass</span></code> object? In words, what is the class of the class object?</p>
<p>The language gets tricky here because of our assumption that we only have
objects and message sending in our system. So our classes also have to be
objects themselves. Since a class lends behaviour to the objects it manufactures,
what class lends the “object manufacturing behaviour” to the class object?
We call such a class a <strong>metaclass</strong>.</p>
<p>Here are some behaviours you want and you can infer by following the same line
of thinking –</p>
<ol class="arabic simple">
<li><p>Since a class lends behaviour to an object, to add behaviour to objects, you
have to add methods to its class. How do you add methods? By sending a
message to the class object! <code class="code highlight racket docutils literal highlight-racket"><span class="p">(</span><span class="n">objclass</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">add-method</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">method-name</span>
<span class="n">block-of-code</span><span class="p">)</span></code>. “Code” in our case consists of a sequence of message sends
to various objects. We could model it as a block expression <code class="code highlight racket docutils literal highlight-racket"><span class="p">(</span><span class="n">block</span>
<span class="p">(</span><span class="n">arg1</span><span class="w"> </span><span class="n">arg2</span><span class="w"> </span><span class="n">..</span><span class="p">)</span><span class="w"> </span><span class="n">...sequence...</span><span class="p">)</span></code> for understanding purposes.</p></li>
<li><p>A class is therefore also responsible for looking up a method when one
of its objects receives a message. Therefore if the received message does
not have a corresponding defined method, the class can look it up
in another “parent” class. The term usually used for such a parent class
is <strong>super class</strong>.</p></li>
<li><p>Creating a new class of objects therefore requires a message send of the
form – <code class="code highlight racket docutils literal highlight-racket"><span class="p">(</span><span class="n">metaclass</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">make-class</span><span class="w"> </span><span class="s2">&quot;class-name&quot;</span><span class="w"> </span><span class="n">super-class</span>
<span class="n">set-of-properties</span><span class="p">)</span></code>. Subsequent to that, you can send <code class="code highlight racket docutils literal highlight-racket"><span class="o">&#39;</span><span class="ss">add-method</span></code>
messages to that class to define behaviour.</p></li>
<li><p>At the top of this hierarchy of classes, there usually sits a “root object”.
This object serves as a parent for all objects in the system via the
inheritance chain. It is in this sense that a language can claim “everything
is an object”. In Javascript, Ruby, Smalltalk and Python, <code class="code highlight racket docutils literal highlight-racket"><span class="n">Object</span></code> is
this root object.</p></li>
</ol>
<table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Types and hierarchy in traditional OOP languages</span><a class="headerlink" href="#id3" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Thing</p></th>
<th class="head"><p>instance of (isa)</p></th>
<th class="head"><p>super class</p></th>
<th class="head"><p>Comment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>aPoint</p></td>
<td><p>PointClass</p></td>
<td><p>_</p></td>
<td><p>No superclass because aPoint is not a class</p></td>
</tr>
<tr class="row-odd"><td><p>PointClass</p></td>
<td><p>PointMetaClass</p></td>
<td><p>Object</p></td>
<td><p>Everything is an object, including classes</p></td>
</tr>
<tr class="row-even"><td><p>PointMetaClass</p></td>
<td><p>MetaClass</p></td>
<td><p>Object</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>MetaClass</p></td>
<td><p>MetaClass</p></td>
<td><p>Object</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Object</p></td>
<td><p>MetaClass</p></td>
<td><p>Object</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The above table is but one way to organize objects. This scheme or a variation
of it is followed in dynamic “pure” object oriented languages like Smalltalk
and Ruby. The addition of “meta classes” seems like a bit of unnecessary
complexity and is often a point of confusion when learning about them. However,
they also offer power in the language – best captured in the book <a class="reference external" href="https://mitpress.mit.edu/9780262610742/the-art-of-the-metaobject-protocol/">The Art of
the metaobject protocol</a>.</p>
<p>Meta classes hold methods for classes and the meta class hierarchy parallels
the class hierarchy. What that means is that if <code class="code highlight racket docutils literal highlight-racket"><span class="n">PointClass</span></code> has
<code class="code highlight racket docutils literal highlight-racket"><span class="n">VectorSpace</span></code> as its super class, then <code class="code highlight racket docutils literal highlight-racket"><span class="n">PointMetaClass</span></code> will have
<code class="code highlight racket docutils literal highlight-racket"><span class="n">VectorSpaceMetaClass</span></code> as its superclass. Meta classes also usually
operate behind the scenes and you won’t have to deal with them in normal code,
as the act of creating a class should also create its associated metaclass
(like <code class="code highlight racket docutils literal highlight-racket"><span class="n">PointClass</span></code>) automatically. This structure is very useful when
constructing highly reflective systems – i.e. systems that can introspect and
modify any aspect of themselves within themselves. For example, in Smalltalk,
the Smalltalk virtual machine is itself written in Smalltalk and is modifiable
within the Smalltalk environment while the program is running. This kind
of dynamism is also present in Ruby which is heavily inspired by Smalltalk.</p>
<p>For our purposes, this is just to let you know that such an organization
exists, so that when you encounter it, you aren’t surprised.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You <strong>won’t</strong> be quizzed on “what is the metaclass of Metaclass?” for example,
because this organization is not universal.</p>
</div>
<p>The meta class system is not found in more conventional languages like C++ and
Java. It is a language design choice. In Java, for example, the class of any
class is just <code class="code highlight racket docutils literal highlight-racket"><span class="n">Class</span></code>. In C++, classes are not objects. In that sense,
C++ is not considered a “pure” object oriented language. In C++, the only
purpose classes serve is to instantiate objects and give them behaviour.
Furthermore, pure object oriented languages completely encapsulate the state
of objects – meaning you cannot peep into them except and can ony interact with
them via message passing. Languages like C++ chose not to go that route for
efficiency reasons when considering ahead-of-time compilation.</p>
</section>
<section id="prototypes">
<h2>Prototypes<a class="headerlink" href="#prototypes" title="Link to this heading">¶</a></h2>
<p>While a “meta class” system offers additional power to a pure OOP language, it is
indeed somewhat complex to have in a language. Is it possible to have the benefits
of objects and delegation without having to deal with such hierarchy?</p>
<p>The answer is yes .. and it is also the basis of an earlier exercise in this chapter
where you were asked to explore the consequences of passing in a “parent object” instead
of creating one within <code class="code highlight racket docutils literal highlight-racket"><span class="n">make-named-point</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Revisit that case if you haven’t already.</p>
</div>
<p>While the most famous prototype based object system is Javascript, the concept
was first introduced in <a class="reference external" href="https://en.wikipedia.org/wiki/Self_(programming_language)">Self</a>. A bit of interesting history there is that Self
was developed by a team at Sun Microsystems and the team developed the dynamic
compilation techniques that later on when into the Java programming language.
<a class="reference external" href="https://en.wikipedia.org/wiki/Self_(programming_language)">Self</a>, for example, does not have the notions of classes or metaclasses, only
objects and delegation!</p>
<p><strong>Delegation</strong> is the term used in prototype based languages to refer to how
one object leverages another object to get functionality. Whenever an object
sees a message that it does not understand, it passes it on to a “delegate”
(sometimes confusingly referred to as “parent”) instead and lets it handle it.
The <a class="reference external" href="https://en.wikipedia.org/wiki/Self_(programming_language)">Self</a> language creators showed that this system is better able to model
real world relationships that are subject to frequent change and evolution, as
compared to class-based object oriented languages which have to freeze
behaviour in hierarchies before they’re fully known, and end up breaking
relationships when something about the problem domain changes.</p>
<p>While Javascript <em>can</em> be used as prototype object system, it is often used in
a traditional single inheritance class structure. This is because the
“prototype chain” of an object in Javascript is used to resolve method lookup
instead of having messages passed up a delegation chain. This means the methods
declared in the prototype actually operate on the target object and not on the
prototype pbject. However, it is possible (though not usually done) to organize
the prototype object such that its methods operate on the prototype object
instead of the target object whose prototype is set to the prototype object.</p>
<p>Here is code to illustrate that –</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<span class="p">}</span>


<span class="kd">function</span><span class="w"> </span><span class="nx">dist2pt</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dy</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">Point</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dist2pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dist2pt</span><span class="p">;</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="mf">40</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">dist2pt</span><span class="p">(</span><span class="nx">p2</span><span class="p">));</span><span class="w"> </span><span class="c1">// Prints 45</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">dist2pt</span><span class="p">(</span><span class="nx">p1</span><span class="p">));</span><span class="w"> </span><span class="c1">// Prints 45</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">specificPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">};</span>
<span class="nx">Point</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dist2pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dist2pt</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">specificPoint</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// The &quot;bind&quot; call force-associates the &quot;this&quot; inside the</span>
<span class="w">    </span><span class="c1">// dist2pt function with the given object instead of</span>
<span class="w">    </span><span class="c1">// it taking on the target object.</span>

<span class="nx">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">);</span>
<span class="nx">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="mf">40</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">dist2pt</span><span class="p">(</span><span class="nx">p2</span><span class="p">));</span><span class="w"> </span><span class="c1">// Prints 174.64249196572982</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">dist2pt</span><span class="p">(</span><span class="nx">p1</span><span class="p">));</span><span class="w"> </span><span class="c1">// Prints 218.68927728629038</span>
</pre></div>
</div>
<p>Note that the target is being completely ignored in the second case. The way to
understand that in Javascript is that a method call like
<code class="docutils literal notranslate"><span class="pre">obj1.methodName(arg1,arg2)</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">obj1.methodName.call(obj1,</span>
<span class="pre">arg1,</span> <span class="pre">arg2)</span></code>. The expression <code class="docutils literal notranslate"><span class="pre">obj1.methodName</span></code> will give you the method
function, whose <code class="docutils literal notranslate"><span class="pre">call</span></code> method is invoked with the given arguments, explicitly
supplying the object to be used as the <code class="docutils literal notranslate"><span class="pre">this</span></code> parameter within the function.
After the <code class="docutils literal notranslate"><span class="pre">bind</span></code>, the method function gets bound to the given object
so that when it is called, it becomes equivalent to <code class="docutils literal notranslate"><span class="pre">dist2pt.call(specificPoint,</span> <span class="pre">p2)</span></code>
irrespective of whether we call it as <code class="docutils literal notranslate"><span class="pre">p1.dist2pt(p2)</span></code> or <code class="docutils literal notranslate"><span class="pre">p2.dist2pt(p2)</span></code>.</p>
<p>In this sense, Javascript is able to support both class based programming as
well as prototype based programming.</p>
</section>
<section id="interfaces-and-traits">
<h2>Interfaces and traits<a class="headerlink" href="#interfaces-and-traits" title="Link to this heading">¶</a></h2>
<p>The term <strong>interface</strong> or <strong>protocol</strong> is used to refer to the collection of
messages that can be sent to an object – or, in languages that treat message
passing as method invocation, the collection of methods that can be invoked on
the object.</p>
<p>In some languages that aren’t particularly “object oriented” (like <a class="reference external" href="https://www.rust-lang.org/">Rust</a>), you
may still find groups of functions that can be called on a value being referred
to by the term <strong>trait</strong>. Since traits/interfaces/protocols refer to the
<strong>pattern</strong> of interaction with compound structures like objects and not to
specific implementations of those patterns, they can usually be freely mixed to
indicate compound functionality in these systems.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Comp308: Principles of Programming Languages</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Welcome note</a></li>
<li class="toctree-l1"><a class="reference internal" href="racket-intro.html">A quick introduction to Racket and Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda.html">λ - the everything</a></li>
<li class="toctree-l1"><a class="reference internal" href="church.html">Lambda - via β-abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="piclang.html">A language for pictures</a></li>
<li class="toctree-l1"><a class="reference internal" href="arithlang.html">A language for arithmetic</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine.html">A mental model for the machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="notional-machine.html">Notional machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="growing.html">Growing the language</a></li>
<li class="toctree-l1"><a class="reference internal" href="fun.html">Functions and scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="fun-arith.html">Functions and scope (arithmetic track)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stacks-and-scope.html">Stacks and scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="fun-in-piclang.html">Functions in PicLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutations.html">Mutations</a></li>
<li class="toctree-l1"><a class="reference internal" href="control.html">Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="generators.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="errornot.html">On the choice between “error” and “do something reasonable” in design</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Objects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#anton-s-koan">Anton’s Koan</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-many-faces-of-objects">The many faces of “objects”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#objects-using-closures">Objects using closures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-essence-of-objects-through-abstraction">The essence of objects through β-abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-behaviour">Adding new behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-state">Adding new state</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lessons-so-far">Lessons so far</a></li>
<li class="toctree-l2"><a class="reference internal" href="#objects-as-the-foundation">Objects as the foundation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prototypes">Prototypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interfaces-and-traits">Interfaces and traits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="objects-self.html">Objects - the Self way</a></li>
<li class="toctree-l1"><a class="reference internal" href="dispatch.html">Polymorphism via dispatch</a></li>
<li class="toctree-l1"><a class="reference internal" href="appsem.html">Alternative application semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Types: Checking some program invariants statically</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="errornot.html" title="previous chapter">On the choice between “error” and “do something reasonable” in design</a></li>
      <li>Next: <a href="objects-self.html" title="next chapter">Objects - the Self way</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, Srikumar K. S..
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/objects.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>